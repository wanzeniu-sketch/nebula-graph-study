<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Neo4j è¿æ¥è¯Šæ–­å·¥å…·</title>
    <script src="https://unpkg.com/neo4j-driver@5.12.0/lib/browser/neo4j-web.min.js"></script>
    <style>
        body { background: #222; color: #fff; font-family: monospace; padding: 20px; }
        #log { white-space: pre-wrap; }
        .success { color: #0f0; }
        .error { color: #f00; }
        button { padding: 10px 20px; font-size: 16px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 4px; }
    </style>
</head>
<body>
    <h2>ğŸ•µï¸ Neo4j è¿æ¥è¯Šæ–­æ¨¡å¼</h2>
    <p>å½“å‰é…ç½®: URL=bolt://localhost:7687 | User=neo4j | Pass=12345678</p>
    <button onclick="testConnection()">å¼€å§‹æµ‹è¯•è¿æ¥</button>
    <hr>
    <div id="log">ç­‰å¾…æµ‹è¯•...</div>

    <script>
        // è¾…åŠ©æ—¥å¿—å‡½æ•°
        function log(msg, type = '') {
            const el = document.getElementById('log');
            const span = document.createElement('div');
            span.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            if (type) span.className = type;
            el.appendChild(span);
            console.log(msg);
        }

        async function testConnection() {
            document.getElementById('log').innerHTML = ''; // æ¸…ç©ºæ—¥å¿—
            log("æ­£åœ¨åˆå§‹åŒ–é©±åŠ¨...");

            const uri = 'bolt://localhost:7687';
            const user = 'neo4j';
            const password = '12345678'; // ä½ çš„å¯†ç 

            try {
                // 1. å°è¯•å»ºç«‹é©±åŠ¨å®ä¾‹ (æ³¨æ„è¿™é‡Œçš„ encrypted é…ç½®)
                const driver = neo4j.driver(
                    uri,
                    neo4j.auth.basic(user, password),
                    { 
                        // æ˜¾å¼å…³é—­åŠ å¯†ï¼Œè¿™æ˜¯æœ¬åœ°è¿æ¥æœ€å…³é”®çš„é…ç½®
                        encrypted: false, 
                        // è®¾ç½®ä¿¡ä»»ç­–ç•¥ï¼ˆè™½ç„¶å…³é—­åŠ å¯†åè¿™ä¸ªé€šå¸¸è¢«å¿½ç•¥ï¼Œä½†åŠ ä¸Šä¿é™©ï¼‰
                        trust: "TRUST_ALL_CERTIFICATES"
                    }
                );

                log("é©±åŠ¨åˆå§‹åŒ–å®Œæˆï¼Œæ­£åœ¨å°è¯•éªŒè¯è¿æ¥...", "info");

                // 2. å°è¯•è·å–ç”±æœåŠ¡å™¨éªŒè¯çš„ä¼šè¯
                await driver.verifyConnectivity();
                log("âœ… è¿æ¥éªŒè¯æˆåŠŸï¼æœåŠ¡å™¨å¯è¾¾ä¸”å¯†ç æ­£ç¡®ã€‚", "success");

                // 3. å°è¯•è¿è¡Œä¸€ä¸ªç®€å•æŸ¥è¯¢
                const session = driver.session();
                log("æ­£åœ¨è¿è¡Œæµ‹è¯•æŸ¥è¯¢: RETURN 1...");
                const result = await session.run('RETURN 1 AS num');
                
                const value = result.records[0].get('num').toInt();
                log(`âœ… æŸ¥è¯¢æˆåŠŸï¼æ•°æ®åº“è¿”å›ç»“æœ: ${value}`, "success");
                
                await session.close();
                await driver.close();
                
                log("æµ‹è¯•ç»“æŸã€‚ç»“è®ºï¼šä½ çš„æµè§ˆå™¨ç¯å¢ƒå®Œå…¨å¯ä»¥è¿æ¥æ•°æ®åº“ã€‚", "success");
                log("ğŸ‘‰ å¦‚æœè¿™é‡ŒæˆåŠŸäº†ï¼Œè¯´æ˜æ˜¯ Neovis çš„é…ç½®å†™æ³•é—®é¢˜ã€‚", "info");

            } catch (error) {
                log(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, "error");
                log(`é”™è¯¯è¯¦æƒ…: ${error.code}`, "error");
                
                if (error.message.includes("Unauthorized")) {
                    log("åˆ†æï¼šæœåŠ¡å™¨æ‹’ç»äº†å¯†ç ã€‚è™½ç„¶ä½ è¯´å¯†ç æ˜¯å¯¹çš„ï¼Œä½†é©±åŠ¨å±‚é¢çš„æ¡æ‰‹è¢«æ‹’ç»äº†ã€‚", "error");
                } else if (error.message.includes("WebSocket")) {
                    log("åˆ†æï¼šWebSocket ç½‘ç»œè¿æ¥æ–­å¼€ã€‚è¿™é€šå¸¸æ˜¯å› ä¸ºæµè§ˆå™¨é˜»æ­¢äº†éåŠ å¯†è¿æ¥ã€‚", "error");
                }
            }
        }
    </script>
</body>
</html>